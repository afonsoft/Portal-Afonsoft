$(function(){var t=$("#NotificationsTable"),e=abp.services.app.notification,a=$("#TargetValueFilterSelectionCombobox");a.selectpicker();var n=new app.UserNotificationHelper,i={startDate:moment().startOf("day").subtract(7,"days"),endDate:moment().endOf("day")};$(document).find("input.date-range-picker").daterangepicker($.extend(!0,app.createDateRangePickerOptions(),i),function(t,e){i.startDate=t.format("YYYY-MM-DDT00:00:00Z"),i.endDate=e.format("YYYY-MM-DDT23:59:59.999Z"),c()});var o=function(t,a){var i=$("<span/>"),o=$("<button/>").addClass("btn btn-sm btn-icon btn-primary").attr("title",app.localize("SetAsRead")).click(function(e){var i,l;e.preventDefault(),i=a,l=function(){o.find("i").removeClass("la-circle-o").addClass("la-check"),o.attr("disabled","disabled"),t.closest("tr").addClass("notification-read")},n.setAsRead(i.id,function(){l&&l()})}).appendTo(i),l=$("<button/>").addClass("btn btn-sm btn-icon btn-danger").attr("title",app.localize("Delete")).click(function(){var t;t=a,abp.message.confirm(app.localize("NotificationDeleteWarningMessage"),app.localize("AreYouSure"),function(a){a&&e.deleteNotification({id:t.id}).done(function(){c(),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}).appendTo(i);$('<i class="la la-remove" >').appendTo(l);var s=$('<i class="la" >').appendTo(o),r=n.format(a).state;"READ"===r&&(o.attr("disabled","disabled"),s.addClass("la-check")),"UNREAD"===r&&s.addClass("la-circle-o"),t.append(i)},l=t.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:e.getUserNotifications,inputFilter:function(){return{state:a.val(),startDate:i.startDate,endDate:i.endDate}}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",createdCell:function(t,e,a,n,i){o($(t),a)}},{targets:2,data:"notification",render:function(t,e,a,i){var o=n.format(a,!1),l=s(o);return(o.url&&"#"!==o.url?$('<a title="'+o.text+'" href="'+o.url+'" class="'+l+'">'+abp.utils.truncateStringWithPostfix(o.text,120)+"</a>"):$('<span title="'+o.text+'" class="'+l+'">'+abp.utils.truncateStringWithPostfix(o.text,120)+"</span>"))[0].outerHTML}},{targets:3,data:"creationTime",render:function(t,e,a,i){var o=n.format(a),l=s(o);return $('<span title="'+moment(a.notification.creationTime).format("llll")+'" class="'+l+'">'+o.timeAgo+"</span> &nbsp;")[0].outerHTML}}]});function s(t){return"READ"===t.state?"notification-read":""}function c(){l.ajax.reload()}a.change(function(){c()}),$("#RefreshNotificationTableButton").click(function(t){t.preventDefault(),c()}),$("#btnOpenNotificationSettingsModal").click(function(t){n.openSettingsModal()}),$("#btnSetAllNotificationsAsRead").click(function(t){t.preventDefault(),n.setAllAsRead(function(){c()})}),$("#DeleteAllNotificationsButton").click(function(t){t.preventDefault(),abp.message.confirm(app.localize("DeleteListedNotificationsWarningMessage"),app.localize("AreYouSure"),function(t){t&&e.deleteAllUserNotifications({state:a.val(),startDate:i.startDate,endDate:i.endDate}).done(function(){c(),abp.notify.success(app.localize("SuccessfullyDeleted"))})})})});