!function(e){app.modals.ChangeProfilePictureModal=function(){var i,r=null,t=null,a=abp.services.app.profile;this.init=function(a){i=a,e("#ChangeProfilePictureModalForm input[name=ProfilePicture]").change(function(){e("#ChangeProfilePictureModalForm").submit()}),e("#ChangeProfilePictureModalForm").ajaxForm({beforeSubmit:function(i,r,t){var a=e("#ChangeProfilePictureModalForm input[name=ProfilePicture]").get()[0].files;if(!a.length)return!1;var l=a[0],n="|"+l.type.slice(l.type.lastIndexOf("/")+1)+"|";if(-1==="|jpg|jpeg|png|gif|".indexOf(n))return abp.message.warn(app.localize("ProfilePicture_Warn_FileType")),!1;if(l.size>5242880)return abp.message.warn(app.localize("ProfilePicture_Warn_SizeLimit",app.maxProfilPictureBytesUserFriendlyValue)),!1;var o=_.filter(i,{name:"ProfilePicture"})[0].value.type;return i.push({name:"FileType",value:o}),i.push({name:"FileName",value:"ProfilePicture"}),i.push({name:"FileToken",value:app.guid()}),!0},success:function(i){if(i.success){var a=e("#ProfilePictureResize"),l=abp.appPath+"File/DownloadTempFile?fileToken="+i.result.fileToken+"&fileName="+i.result.fileName+"&fileType="+i.result.fileType+"&v="+(new Date).valueOf();t=i.result.fileToken,r&&r.destroy(),a.show(),a.attr("src",l),a.attr("originalWidth",i.result.width),a.attr("originalHeight",i.result.height),a.Jcrop({setSelect:[0,0,100,100],aspectRatio:1,boxWidth:400,boxHeight:400},function(){r=this})}else abp.message.error(i.error.message)}}),e("#ProfilePictureResize").hide()},this.save=function(){if(t){var l={};r&&(l=r.getSelection());var n=r.getContainerSize()[0],o=r.getContainerSize()[1],u=n,s=o;e("#ProfilePictureResize")&&(u=parseInt(e("#ProfilePictureResize").attr("originalWidth")),s=parseInt(e("#ProfilePictureResize").attr("originalHeight")));var f=u/n,p=s/o;a.updateProfilePicture({fileToken:t,x:parseInt(l.x*f),y:parseInt(l.y*p),width:parseInt(l.w*f),height:parseInt(l.h*p)}).done(function(){r.destroy(),r=null,e(".header-profile-picture").attr("src",app.getUserProfilePicturePath()),i.close()})}}}}(jQuery);