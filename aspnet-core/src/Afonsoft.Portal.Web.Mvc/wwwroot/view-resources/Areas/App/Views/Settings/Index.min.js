$(function(){var e=abp.services.app.tenantSettings,t=$("#GeneralSettingsForm [name=Timezone]").val(),i=$("#GeneralSettingsForm [name=TimezoneForComparison]").val()===abp.setting.values["Abp.Timing.TimeZone"],n=$("#FormBasedRegistrationSettingsForm").find("input[name=IsNewRegisteredUserActiveByDefault],input[name=UseCaptchaOnRegistration]").closest(".md-checkbox"),s=$("#FormBasedRegistrationSettingsForm").find(".divSessionTimeOut");function o(){$("#Setting_AllowSelfRegistration").is(":checked")?n.slideDown("fast"):n.slideUp("fast")}function a(){$("#Setting_IsSessionTimeOutEnabled").is(":checked")?s.slideDown("fast"):s.slideUp("fast")}$("#Settings_UseHostDefaultEmailSettings").change(function(){this.checked?$("#Settings_Email_Group").slideUp():$("#Settings_Email_Group").slideDown()}),$("#Setting_AllowSelfRegistration").change(function(){o()}),o(),a();var r=$("#EmailSmtpSettingsForm").find("input[name=SmtpDomain],input[name=SmtpUserName],input[name=SmtpPassword]").closest(".form-group");function l(){$("#Settings_SmtpUseDefaultCredentials").is(":checked")?r.slideUp("fast"):r.slideDown("fast")}$("#Settings_SmtpUseDefaultCredentials").change(function(){l()}),$("#Setting_IsSessionTimeOutEnabled").change(function(){a()}),l();var c=$("#LdapSettingsForm").find("input[name=Domain],input[name=UserName],input[name=Password]").closest(".form-group");function m(){$("#Setting_LdapIsEnabled").is(":checked")?c.slideDown("fast"):c.slideUp("fast")}m(),$("#Setting_LdapIsEnabled").change(function(){m()});var p=$("#UserLockOutSettingsForm").find("input").not("#Setting_UserLockOut_IsEnabled").closest(".form-group");function d(){$("#Setting_UserLockOut_IsEnabled").is(":checked")?p.slideDown("fast"):p.slideUp("fast")}d(),$("#Setting_UserLockOut_IsEnabled").change(function(){d()});var g=$("#TwoFactorLoginSettingsForm").find("input").not("#Setting_TwoFactorLogin_IsEnabled").closest(".md-checkbox");function u(){$("#Setting_TwoFactorLogin_IsEnabled").is(":checked")?g.slideDown("fast"):g.slideUp("fast")}function f(){var e=$("#DefaultPasswordComplexitySettingsForm input:disabled");e.removeAttr("disabled");var t=$("#DefaultPasswordComplexitySettingsForm").serializeFormToObject();return e.attr("disabled","disabled"),t}function S(e){$(".kt-header__brand-logo-default").attr("src",e)}function F(e){$("#TenantCustomCss").remove(),e&&$("head").append('<link id="TenantCustomCss" href="'+e+'" rel="stylesheet"/>')}u(),$("#Setting_TwoFactorLogin_IsEnabled").change(function(){u()}),$("#Setting_PasswordComplexity_UseDefaultSettings").change(function(e){$("#Setting_PasswordComplexity_UseDefaultSettings").is(":checked")?($("#DefaultPasswordComplexitySettingsForm").show(),$("#PasswordComplexitySettingsForm").hide()):($("#DefaultPasswordComplexitySettingsForm").hide(),$("#PasswordComplexitySettingsForm").show())}),$("#SettingsLogoUploadForm").ajaxForm({beforeSubmit:function(e,t,i){var n=$("#SettingsLogoUploadForm input[name=ApplicationLogoImage]").get()[0].files;if(!n.length)return!1;var s=n[0],o="|"+s.type.slice(s.type.lastIndexOf("/")+1)+"|";return-1==="|jpg|jpeg|png|gif|".indexOf(o)?(abp.message.warn(app.localize("File_Invalid_Type_Error")),!1):!(s.size>30720&&(abp.message.warn(app.localize("File_SizeLimit_Error")),1))},success:function(e){e.success?(S(abp.appPath+"TenantCustomization/GetLogo?tenantId="+e.result.tenantId+"&t="+(new Date).getTime()),abp.notify.info(app.localize("SavedSuccessfully"))):abp.message.error(e.error.message)}}),$("#SettingsLogoUploadForm button[type=reset]").click(function(){e.clearLogo().done(function(){S(abp.appPath+"Common/Images/app-logo-on-light.svg"),abp.notify.info(app.localize("ClearedSuccessfully"))})}),$("#SettingsCustomCssUploadForm").ajaxForm({beforeSubmit:function(e,t,i){var n=$("#SettingsCustomCssUploadForm input[name=CustomCssFile]").get()[0].files;if(!n.length)return!1;var s=n[0],o="|"+s.type.slice(s.type.lastIndexOf("/")+1)+"|";return-1==="|css|".indexOf(o)?(abp.message.warn(app.localize("File_Invalid_Type_Error")),!1):!(s.size>1048576&&(abp.message.warn(app.localize("File_SizeLimit_Error")),1))},success:function(e){e.success?(F(abp.appPath+"TenantCustomization/GetCustomCss?tenantId="+e.result.tenantId),abp.notify.info(app.localize("SavedSuccessfully"))):abp.message.error(e.error.message)}}),$("#SettingsCustomCssUploadForm button[type=reset]").click(function(){e.clearCustomCss().done(function(){F(null),abp.notify.info(app.localize("ClearedSuccessfully"))})}),$("#SaveAllSettingsButton").click(function(){var n=$.extend($("#FormBasedRegistrationSettingsForm").serializeFormToObject(),$("#OtherSettingsForm").serializeFormToObject());n.sessionTimeOutSettings={isEnabled:$("#Setting_IsSessionTimeOutEnabled").is(":checked"),timeOutSecond:$("#Setting_SessionTimeOutSecond").val(),showTimeOutNotificationSecond:$("#Setting_ShowTimeOutNotificationSecond").val()},e.updateAllSettings({general:$("#GeneralSettingsForm").serializeFormToObject(),userManagement:n,email:$("#EmailSmtpSettingsForm").serializeFormToObject(),ldap:$("#LdapSettingsForm").serializeFormToObject(),billing:$("#BillingSettingsForm").serializeFormToObject(),otherSettings:$("#OtherSettingsForm").serializeFormToObject(),security:{useDefaultPasswordComplexitySettings:$("#Setting_PasswordComplexity_UseDefaultSettings").is(":checked"),passwordComplexity:$("#PasswordComplexitySettingsForm").serializeFormToObject(),defaultPasswordComplexity:f(),userLockOut:$("#UserLockOutSettingsForm").serializeFormToObject(),twoFactorLogin:$("#TwoFactorLoginSettingsForm").serializeFormToObject(),AllowOneConcurrentLoginPerUser:$("#Setting_AllowOneConcurrentLoginPerUser").is(":checked")}}).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));var e=$("#GeneralSettingsForm [name=Timezone]").val();abp.clock.provider.supportsMultipleTimezone&&i&&t!==e&&abp.message.info(app.localize("TimeZoneSettingChangedRefreshPageNotification")).done(function(){window.location.reload()})})}),$("#SendTestEmailButton").click(function(){e.sendTestEmail({emailAddress:$("#TestEmailAddressInput").val()}).done(function(){abp.notify.info(app.localize("TestEmailSentSuccessfully"))})})});