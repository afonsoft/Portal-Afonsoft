$(function(){var a=abp.services.app.dashboardCustomization,e=new app.ModalManager({viewUrl:abp.appPath+"App/"+$("#DashboardName").val()+"/AddWidgetModal",scriptUrl:abp.appPath+"view-resources/Areas/App/Views/CustomizableDashboard/_AddWidgetModal.js",modalClass:"AddWidgetModal"}),t=function(a){a?($(".deleteWidgetButton").removeClass("d-none"),$(".div-dashboard-customization").removeClass("d-none")):($(".deleteWidgetButton").addClass("d-none"),$(".div-dashboard-customization").addClass("d-none"))};$(".grid-stack").gridstack({alwaysShowResizeHandle:!1,cellHeight:15,animate:!0});var i=function(){location.reload()},n=function(){return $("#PagesDiv").find(".active").find('input[name="PageId"]').val()},d=function(){return $("#PagesDiv").find(".active").find('input[name="PageName"]').val()};$("#AddWidgetButton").click(function(){e.open({dashboardName:$("#DashboardName").val(),pageId:n()})}),abp.event.on("app.addWidgetModalSaved",function(){i()}),$("#DeletePageButton").click(function(){var e=$("#dashboardPageCount").val()>1?app.localize("PageDeleteWarningMessage",d()):app.localize("BackToDefaultPageWarningMessage",d());abp.message.confirm(e,app.localize("AreYouSure"),function(e){e&&a.deletePage({dashboardName:$("#DashboardName").val(),id:n(),application:"Mvc"}).done(function(a){i()})})}),$("#RenamePageSaveButton").on("click",function(){let e=$("#RenamePageNameInput").val();""!==(e=e.trim())?a.renamePage({dashboardName:$("#DashboardName").val(),id:n(),name:e,application:"Mvc"}).done(function(a){abp.notify.success(app.localize("Renamed")),i()}):abp.notify.error(app.localize("PageNameCanNotBeEmpty"))}),$("#AddPageSaveButton").on("click",function(){let e=$("#PageNameInput").val();""!==(e=e.trim()).trim()?a.addNewPage({dashboardName:$("#DashboardName").val(),name:e,application:"Mvc"}).done(function(a){abp.notify.success(app.localize("Saved")),i()}):abp.notify.error(app.localize("PageNameCanNotBeEmpty"))}),$("#RenamePageDropdownMenuButton").on("click",function(){$("#RenamePageNameInput").attr("placeholder",d()),$("#RenamePageNameInput").val("")}),$("#AddPageButtonDropdownMenuButton").on("click",function(){$("#PageNameInput").val("")}),$("#EditableCheckbox").change(function(){$(this).is(":checked")?(t(!0),$(".grid-stack").each(function(){$(this).data("gridstack").enable()})):(t(!1),$(".grid-stack").each(function(){$(this).data("gridstack").disable()}))}),$(document).on("click",".deleteWidgetButton",function(){var a=$(this).closest(".grid-stack-item");abp.message.confirm(app.localize("WidgetDeleteWarningMessage",a.attr("data-widget-name"),d()),app.localize("AreYouSure"),function(e){e&&a.remove()})}),$(window).on("load",function(){$(".grid-stack-item-content").mCustomScrollbar({theme:"minimal-dark"}),$(".grid-stack").each(function(){$(this).data("gridstack").disable()})}),$("#savePageButton").on("click",function(){!function(){abp.ui.setBusy($("body"));for(var e=[],t=$("#PagesDiv").find(".page"),i=0;i<t.length;i++){for(var n=t[i],d=$(n).find('input[name="PageId"]').val(),o=$(n).find('input[name="PageName"]').val(),c=$(n).find(".grid-stack-item"),s=[],r=0;r<c.length;r++){var l={};l.widgetId=$(c[r]).attr("data-widget-id"),l.height=$(c[r]).attr("data-gs-height"),l.width=$(c[r]).attr("data-gs-width"),l.positionX=$(c[r]).attr("data-gs-x"),l.positionY=$(c[r]).attr("data-gs-y"),s[r]=l}e.push({id:d,name:o,widgets:s})}var g=[],p=$("#FiltersDiv");if(p){var u=$(p).find(".grid-stack-item");for(r=0;r<u.length;r++){var m={};m.widgetFilterId=$(u[r]).attr("data-filter-id"),m.height=$(u[r]).attr("data-gs-height"),m.width=$(u[r]).attr("data-gs-width"),m.positionX=$(u[r]).attr("data-gs-x"),m.positionY=$(u[r]).attr("data-gs-y"),g[r]=m}}a.savePage({dashboardName:$("#DashboardName").val(),pages:e,widgetFilters:g,application:"Mvc"}).done(function(a){abp.notify.success(app.localize("Saved")),$("#EditableCheckbox").prop("checked",!1).trigger("change")}).always(function(){abp.ui.clearBusy($("body"))})}()})});