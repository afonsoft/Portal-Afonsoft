$(function(){var t=abp.services.app.hostDashboard,a=$(".income-statistics"),e=a.find("input[name='IncomeStatisticsDatePeriod']"),n=a.find(".income-statistics-chart"),o=a.find(".caption-helper"),i=app.widgetBase.create(),s=1,d={startDate:moment().add(-7,"days").startOf("day"),endDate:moment().endOf("day")},r=function(t){var a=null;o.text(d.startDate.format("L")+" - "+d.endDate.format("L"));for(var i=[],r=0;r<t.length;r++){var l=new Array(2);l[0]=moment(t[r].date).utc().valueOf(),l[1]=t[r].amount,i.push(l)}if(i,t&&0!==t.length){$.plot(n,[{data:i,lines:{fill:.2,lineWidth:1},color:["#BAD9F5"]},{data:i,points:{show:!0,fill:!0,radius:4,fillColor:"#9ACAE6",lineWidth:2},color:"#9ACAE6",shadowSize:1},{data:i,lines:{show:!0,fill:!1,lineWidth:3},color:"#9ACAE6",shadowSize:0}],{xaxis:{mode:"time",timeformat:app.localize("ChartDateFormat"),minTickSize:[1,"day"],font:{lineHeight:20,style:"normal",variant:"small-caps",color:"#6F7B8A",size:10}},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{hoverable:!0,clickable:!1,tickColor:"#eee",borderColor:"#eee",borderWidth:1,margin:{bottom:20}}});var c=function(){var t=$("#chartTooltip");0!==t.length&&t.remove()};n.bind("plothover",function(t,n,o){if(o&&a!==o.dataIndex){var i=parseInt(e.closest(":checked").val()),r="",l=d.startDate.format("L")===d.endDate.format("L");if(i===s||l)r=moment(o.datapoint[0]).format("dddd, DD MMMM YYYY");else{var m=o.dataIndex===o.series.data.length-1;if(r+=moment(o.datapoint[0]).format("LL"),m)r+=" - "+d.endDate.format("LL");else{var p=o.series.data[o.dataIndex+1];r+=" - "+moment(p[0]).format("LL")}}a=o.dataIndex;var f=app.localize("IncomeWithAmount","<strong>"+o.datapoint[1]+"$</strong>");!function(t,a,e,n){c(),$("<div id='chartTooltip' class='chart-tooltip'>"+e+"<br/>"+n+"</div >").css({position:"absolute",display:"none",top:a-60,left:t-40,border:"0",padding:"2px 6px",opacity:"0.9"}).appendTo("body").fadeIn(200)}(o.pageX,o.pageY,r,f)}}),n.bind("mouseleave",function(){a=null,c()})}else n.html($("<div/>").addClass("note").addClass("note-info").addClass("text-center").append($("<small/>").addClass("text-muted").text("- "+app.localize("NoData")+" -")))},l=function(){abp.ui.setBusy(a),t.getIncomeStatistics({startDate:d.startDate.format("YYYY-MM-DDT00:00:00Z"),endDate:d.endDate.format("YYYY-MM-DDT23:59:59.999Z"),incomeStatisticsDateInterval:1}).done(function(t){r(t.incomeStatistics)}).always(function(){abp.ui.clearBusy(a)})};abp.event.on("app.dashboardFilters.DateRangePicker.OnDateChange",function(t){!t||d.startDate===t.startDate&&d.endDate===t.endDate||(d.startDate=t.startDate,d.endDate=t.endDate,i.runDelayed(l))}),a.find("input[name='IncomeStatisticsDatePeriod']").change(function(){this.checked&&l()}),i.runDelayed(l)});