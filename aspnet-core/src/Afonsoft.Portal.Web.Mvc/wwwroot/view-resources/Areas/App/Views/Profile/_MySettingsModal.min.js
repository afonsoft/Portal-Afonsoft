app.modals.MySettingsModal=function(){var e,i=abp.services.app.profile,n=null,o=null;this.init=function(a){var t=(e=a).getModal();(o=t.find("form[name=MySettingsModalForm]")).validate(),n=o.find("[name='Timezone']").val(),t.find("#btnEnableGoogleAuthenticator").click(function(){i.updateGoogleAuthenticatorKey().done(function(e){t.find(".google-authenticator-enable").show(),t.find(".google-authenticator-disable").hide(),t.find("img").attr("src",e.qrCodeSetupImageUrl)}).always(function(){e.setBusy(!1)})}),t.find("#btnDisableGoogleAuthenticator").click(function(){i.disableGoogleAuthenticator().done(function(e){t.find(".google-authenticator-enable").hide(),t.find(".google-authenticator-disable").show(),t.find("img").attr("src","")}).always(function(){e.setBusy(!1)})});var r=t.find("#btnSmsVerification"),l=new app.ModalManager({viewUrl:abp.appPath+"App/Profile/SmsVerificationModal",scriptUrl:abp.appPath+"view-resources/Areas/App/Views/Profile/_SmsVerificationModal.js",modalClass:"SmsVerificationModal"});r.click(function(){i.sendVerificationSms({phoneNumber:$("#PhoneNumber").val()}).done(function(){l.open({},function(){$("#SpanSmsVerificationVerified").show(),$("#btnSmsVerification").attr("disabled",!0),o.find(".tooltips").tooltip()})})}),o.find(".tooltips").tooltip(),$("#PhoneNumber").keyup(function(){$("#savedPhoneNumber").val()!=$(this).val()||0==$("#isPhoneNumberConfirmed").val()?($("#SpanSmsVerificationVerified").hide(),$("#btnSmsVerification").removeAttr("disabled")):($("#SpanSmsVerificationVerified").show(),$("#btnSmsVerification").attr("disabled",!0))})},this.save=function(){if(o.valid()){var a=o.serializeFormToObject();e.setBusy(!0),i.updateCurrentUserProfile(a).done(function(){$("#HeaderCurrentUserName").text(a.UserName),abp.notify.info(app.localize("SavedSuccessfully")),e.close();var i=o.find("[name='Timezone']").val();abp.clock.provider.supportsMultipleTimezone&&n!==i&&abp.message.info(app.localize("TimeZoneSettingChangedRefreshPageNotification")).done(function(){window.location.reload()})}).always(function(){e.setBusy(!1)})}}};