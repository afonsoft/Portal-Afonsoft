!function(t){t(function(){var e,a=t("#AuditLogsTable"),n=t("#AuditLogFilterForm"),i=t("#EntityChangesTable"),o=t("#EntityChangeFilterForm"),r=abp.services.app.auditLog,l=e={startDate:moment().startOf("day"),endDate:moment().endOf("day")};n.find("input.date-range-picker").daterangepicker(t.extend(!0,app.createDateRangePickerOptions(),l),function(t,e){l.startDate=t.format("YYYY-MM-DDT00:00:00Z"),l.endDate=e.format("YYYY-MM-DDT23:59:59.999Z"),p()}),o.find("input.date-range-picker").daterangepicker(t.extend(!0,app.createDateRangePickerOptions(),e),function(t,a){e.startDate=t.format("YYYY-MM-DDT00:00:00Z"),e.endDate=a.format("YYYY-MM-DDT23:59:59.999Z"),m()}),r.getEntityHistoryObjectTypes().done(function(e){t.each(e,function(e,a){t("#EntityTypeFullName").append(t("<option></option>").text(a.name).val(a.value))})});var d=a.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:r.getAuditLogs,inputFilter:function(){return u()}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",rowAction:{element:t("<div/>").addClass("text-center").append(t("<button/>").addClass("btn btn-outline-primary btn-sm btn-icon").attr("title",app.localize("AuditLogDetail")).append(t("<i/>").addClass("la la-search"))).click(function(){!function(e){t("#AuditLogDetailModal_UserName").html(e.userName),t("#AuditLogDetailModal_ClientIpAddress").html(e.clientIpAddress),t("#AuditLogDetailModal_ClientName").html(e.clientName),t("#AuditLogDetailModal_BrowserInfo").html(e.browserInfo),t("#AuditLogDetailModal_ServiceName").html(e.serviceName),t("#AuditLogDetailModal_MethodName").html(e.methodName),t("#AuditLogDetailModal_ExecutionTime").html(moment(e.executionTime).fromNow()+" ("+moment(e.executionTime).format("YYYY-MM-DD hh:mm:ss")+")"),t("#AuditLogDetailModal_Duration").html(app.localize("Xms",e.executionDuration)),t("#AuditLogDetailModal_Parameters").html(function(t){try{var e=JSON.parse(t);return JSON.stringify(e,null,4)}catch(e){return t}}(e.parameters)),e.impersonatorUserId?t("#AuditLogDetailModal_ImpersonatorInfo").show():t("#AuditLogDetailModal_ImpersonatorInfo").hide();e.exception?(t("#AuditLogDetailModal_Success").hide(),t("#AuditLogDetailModal_Exception").show(),t("#AuditLogDetailModal_Exception").html(e.exception)):(t("#AuditLogDetailModal_Exception").hide(),t("#AuditLogDetailModal_Success").show());e.customData?(t("#AuditLogDetailModal_CustomData_None").hide(),t("#AuditLogDetailModal_CustomData").show(),t("#AuditLogDetailModal_CustomData").html(e.customData)):(t("#AuditLogDetailModal_CustomData").hide(),t("#AuditLogDetailModal_CustomData_None").show());t("#AuditLogDetailModal").modal("show")}(t(this).data())})}},{targets:2,data:"exception",orderable:!1,render:function(e){var a=t("<div/>").addClass("text-center");return e?a.append(t("<i/>").addClass("fa fa-exclamation-triangle kt-font-warning").attr("title",app.localize("HasError"))):a.append(t("<i/>").addClass("fa fa-check-circle kt-font-success").attr("title",app.localize("Success"))),a[0].outerHTML}},{targets:3,data:"userName"},{targets:4,data:"serviceName"},{targets:5,data:"methodName"},{targets:6,data:"executionDuration",render:function(t){return app.localize("Xms",t)}},{targets:7,data:"clientIpAddress",orderable:!1},{targets:8,data:"clientName"},{targets:9,data:"browserInfo",render:function(e){return t("<span/>").text(abp.utils.truncateStringWithPostfix(e,32)).attr("title",e)[0].outerHTML}},{targets:10,data:"executionTime",render:function(t){return moment(t).format("YYYY-MM-DD HH:mm:ss")}}]}),s=i.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:r.getEntityChanges,inputFilter:function(){return c()}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",rowAction:{element:t("<div/>").addClass("text-center").append(t("<button/>").addClass("btn btn-outline-primary btn-sm btn-icon").attr("title",app.localize("EntityChangeDetail")).append(t("<i/>").addClass("la la-search"))).click(function(){var e;e=t(this).data(),new app.ModalManager({viewUrl:abp.appPath+"App/AuditLogs/EntityChangeDetailModal",modalClass:"EntityChangeDetailModal"}).open({entityChangeListDto:e})})}},{targets:2,data:"changeTypeName",orderable:!1,render:function(t){return app.localize(t)}},{targets:3,data:"entityTypeFullName",render:function(t){return app.localize(t)}},{targets:4,data:"userName"},{targets:5,data:"changeTime",render:function(t){return moment(t).format("YYYY-MM-DD HH:mm:ss")}}]});function u(){var e={};return n.serializeArray().map(function(t){e[abp.utils.toCamelCase(t.name)]=t.value}),t.extend(e,l)}function c(){var a={};return o.serializeArray().map(function(t){a[abp.utils.toCamelCase(t.name)]=t.value}),t.extend(a,e)}function p(){d.ajax.reload()}function m(){s.ajax.reload()}t("#RefreshAuditLogsButton").click(function(t){t.preventDefault(),p()}),t("#RefreshEntityChangesButton").click(function(t){t.preventDefault(),m()}),t("#ExportAuditLogsToExcelButton").click(function(t){t.preventDefault(),r.getAuditLogsToExcel(u()).done(function(t){app.downloadTempFile(t)})}),t("#ExportEntityChangesToExcelButton").click(function(t){t.preventDefault(),r.getEntityChangesToExcel(c()).done(function(t){app.downloadTempFile(t)})}),t("#ShowAdvancedFiltersSpan").click(function(){t("#ShowAdvancedFiltersSpan").hide(),t("#HideAdvancedFiltersSpan").show(),t("#AdvacedAuditFiltersArea").slideDown()}),t("#HideAdvancedFiltersSpan").click(function(){t("#HideAdvancedFiltersSpan").hide(),t("#ShowAdvancedFiltersSpan").show(),t("#AdvacedAuditFiltersArea").slideUp()}),n.keydown(function(t){13===t.which&&(t.preventDefault(),p())}),o.keydown(function(t){13===t.which&&(t.preventDefault(),m())})})}(jQuery);