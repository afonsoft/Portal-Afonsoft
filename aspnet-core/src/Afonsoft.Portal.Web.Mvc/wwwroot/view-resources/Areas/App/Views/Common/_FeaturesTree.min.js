var FeaturesTree=function(e){return function(){var t;return{init:function(a){function n(){t.find(".jstree-node").each(function(){var a=e(this),n=a.find(".jstree-anchor"),r=JSON.parse(a.attr("data-feature")),i=a.attr("data-feature-value");if(r&&r.inputType)if("CHECKBOX"==r.inputType.name);else if("SINGLE_LINE_STRING"==r.inputType.name){if(!a.find(".feature-tree-textbox").length){n.find(".jstree-checkbox").hide();var u="text";r.inputType.validator&&"NUMERIC"==r.inputType.validator.name&&(u="number");var o=e('<input class="feature-tree-textbox" type="'+u+'" />').val(i).on("change",function(){t.jstree(!0)._model.data[r.name].li_attr["data-feature-value"]=o.val()});"number"==u?(o.attr("min",r.inputType.validator.minValue),o.attr("max",r.inputType.validator.maxValue)):r.inputType.validator&&"STRING"==r.inputType.validator.name&&(r.inputType.validator.maxLength>0&&o.attr("maxlength",r.inputType.validator.maxLength),r.inputType.validator.minLength>0&&o.attr("required","required"),r.inputType.validator.regularExpression&&o.attr("pattern",r.inputType.validator.regularExpression)),o.on("input propertychange paste",function(){!function(e,t){if(!e||!e.inputType||!e.inputType.validator)return!0;var a=e.inputType.validator;if("STRING"==a.name){if(null==t||null==t)return a.allowNull;if("string"!=typeof t)return!1;if(a.minLength>0&&t.length<a.minLength)return!1;if(a.maxLength>0&&t.length>a.maxLength)return!1;if(a.regularExpression)return new RegExp(a.regularExpression).test(t)}else if("NUMERIC"==a.name){var n=parseInt(t);if(isNaN(n))return!1;var r=a.minValue;if(r>n)return!1;var i=a.maxValue;if(i>0&&n>i)return!1}return!0}(r,o.val())?o.addClass("feature-tree-textbox-invalid"):(a.attr("data-feature-value",o.val()),o.removeClass("feature-tree-textbox-invalid"))}),o.appendTo(a)}}else if("COMBOBOX"==r.inputType.name&&!a.find(".feature-tree-combobox").length){n.find(".jstree-checkbox").hide();var l=e('<select class="feature-tree-combobox" />');_.each(r.inputType.itemSource.items,function(t){e("<option></option>").attr("value",t.value).text(t.displayText).appendTo(l)}),l.val(i).on("change",function(){t.jstree(!0)._model.data[r.name].li_attr["data-feature-value"]=l.val()}).appendTo(a)}})}(t=a).on("ready.jstree",function(){n()}).on("redraw.jstree",function(){n()}).on("after_open.jstree",function(){n()}).on("create_node.jstree",function(){n()}).on("changed.jstree",function(a,n){var r;n.node&&(n.node.state.selected?(function e(a){t.jstree("select_node",a,!0);var n=t.jstree("get_parent",a);n&&e(n)}(t.jstree("get_parent",n.node)),r=e.makeArray(t.jstree("get_node",n.node).children),t.jstree("select_node",r)):(r=e.makeArray(t.jstree("get_node",n.node).children),t.jstree("deselect_node",r)))}).jstree({types:{default:{icon:"fa fa-folder kt--font-warning"},file:{icon:"fa fa-file kt--font-warning"}},checkbox:{keep_selected_style:!1,three_state:!1,cascade:""},plugins:["checkbox","types"]})},getFeatureValues:function(){var a=[];return e.each(t.jstree(!0)._model.data,function(e,t){if(t.li_attr){var n=JSON.parse(t.li_attr["data-feature"]);"CHECKBOX"==n.inputType.name?a.push({name:n.name,value:t.state.selected}):a.push({name:n.name,value:t.li_attr["data-feature-value"]})}}),a},isValid:function(){return t.find(".feature-tree-textbox-invalid").length<=0}}}}(jQuery);