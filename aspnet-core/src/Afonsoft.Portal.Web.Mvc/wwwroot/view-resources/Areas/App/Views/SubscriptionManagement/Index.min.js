$(function(){var e,n=$("#PaymentHistoryTable"),t=abp.services.app.payment,a=abp.services.app.invoice,r=abp.services.app.subscription;function i(){return n.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:t.getPaymentHistory},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",rowAction:{element:$("<button/>").addClass("btn btn-xs btn-primary").text(app.localize("ShowInvoice")).click(function(){var n,t,r;n=$(this).data(),t=n.invoiceNo,r=n.id,t?window.open("/App/Invoice?paymentId="+r,"_blank"):a.createInvoice({subscriptionPaymentId:r}).done(function(){e.ajax.reload(),window.open("/App/Invoice?paymentId="+r,"_blank")})})}},{targets:2,data:"creationTime",render:function(e){return moment(e).format("L")}},{targets:3,data:"editionDisplayName"},{targets:4,data:"gateway",render:function(e){return app.localize("SubscriptionPaymentGatewayType_"+e)}},{targets:5,data:"amount",render:$.fn.dataTable.render.number(",",".",2)},{targets:6,data:"status",render:function(e){return app.localize("SubscriptionPaymentStatus_"+e)}},{targets:7,data:"paymentPeriodType",render:function(e){return app.localize("PaymentPeriodType_"+e)}},{targets:8,data:"dayCount"},{targets:9,data:"externalPaymentId"},{targets:10,data:"invoiceNo"},{targets:11,visible:!1,data:"id"}]})}$('a[data-toggle="tab"]').on("shown.bs.tab",function(n){if("#SubscriptionManagementPaymentHistoryTab"===$(n.target).attr("href")){if(e)return;e=i()}}),$("#btnDisableRecurringPayments").click(function(){abp.ui.setBusy(),r.disableRecurringPayments({}).done(function(){abp.ui.clearBusy(),$("#btnEnableRecurringPayments").closest("div.form-group").removeClass("d-none"),$("#btnDisableRecurringPayments").closest("div.form-group").addClass("d-none"),$("#btnExtend")&&$("#btnExtend").removeClass("d-none")})}),$("#btnEnableRecurringPayments").click(function(){abp.ui.setBusy(),r.enableRecurringPayments({}).done(function(){abp.ui.clearBusy(),$("#btnDisableRecurringPayments").closest("div.form-group").removeClass("d-none"),$("#btnEnableRecurringPayments").closest("div.form-group").addClass("d-none"),$("#btnExtend").addClass("d-none")})})});